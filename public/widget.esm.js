function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=["target","book_language","customer_id"],r=[],a=Object.entries(e);if(a.forEach((function(e){var a=t(e,2),i=a[0],o=a[1];Boolean(n.includes(i)&&o)||r.push("Speechki Widget error: Please specify ".concat(i))})),!r.length)return!0;r.forEach((function(e){return console.error(e)}))}function a(e){var t=new URLSearchParams;return["customer_id","book_language"].forEach((function(n){return t.set(n,e[n])})),t.toString()}var i=function(){function t(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.subs={},window.addEventListener("message",this.select.bind(this)),window.addEventListener("beforeunload",(function(){window.removeEventListener("message",n.select.bind(n))}))}var n,r,a;return n=t,r=[{key:"select",value:function(e){var t=e.data;"speechki-select"===t.event&&this.fire("select",this.data(t))}},{key:"data",value:function(e){return e.event=e.event.replace("speechki-",""),e}},{key:"on",value:function(e,t){var n=this,r=this.subs[e];return r||(r=this.subs[e]=[]),r.push(t),{name:e,callback:t,off:function(e,t){return n.off(e,t)}}}},{key:"off",value:function(e,t){if(this.handlers[e]){var n=this.subs[e];t?subs=subs.filter((function(e){return e!=fn})):n.length=0}}},{key:"offAll",value:function(){for(var e in this.subs)this.subs.hasOwnProperty(e)&&this.off(e)}},{key:"fire",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=this.subs[e];a&&a.length&&a.forEach((function(e){e.apply(void 0,n)}))}},{key:"changeLanguage",value:function(e){e?this.instance.contentWindow.postMessage({event:"change_language",data:{language:e}},"*"):console.error("Speechki Widget: Please specify language")}}],r&&e(n.prototype,r),a&&e(n,a),Object.defineProperty(n,"prototype",{writable:!1}),t}(),o={widget:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r(e)){var t=e.target;"string"==typeof t&&(t=document.querySelector(t)),t||console.error("Speechki Widget error: No such target element found");var n=document.createElement("iframe"),o="https://widget.speechki.org/?"+a(e);n.setAttribute("src",o),n.style.background="transparent",n.style.visibility="visible",n.style.border="0",n.style.width="100%",n.style.height="100%",t.appendChild(n);var s=new i(n);return s}}};export{o as default};
